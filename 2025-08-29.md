SELECT
  emp.codi_emp,
  emp.nome_emp,
  COUNT(DISTINCT fun.i_empregados) AS qtd_funcionarios_folha
FROM bethadba.foempregados fun
JOIN bethadba.focargos   car     ON car.i_cargos = fun.i_cargos
                                AND car.codi_emp = fun.codi_emp
JOIN bethadba.fodepto    dpto    ON dpto.i_depto = fun.i_depto
                                AND dpto.codi_emp = fun.codi_emp
JOIN bethadba.geempre    emp     ON emp.codi_emp = fun.codi_emp
WHERE fun.codi_emp IS NOT NULL
  AND fun.tipo_epr = 2
  AND EXISTS (
      SELECT 1
      FROM bethadba.fomovto mov
      WHERE mov.codi_emp     = fun.codi_emp
        AND mov.i_empregados = fun.i_empregados
        AND mov.data BETWEEN '2025-08-01' AND '2025-08-31'
        AND mov.tipo_proces  = 11
  )
GROUP BY emp.codi_emp, emp.nome_emp
ORDER BY emp.codi_emp;





SELECT
  emp.codi_emp,
  emp.nome_emp,
  COUNT(DISTINCT fun.i_empregados) AS qtd_funcionarios
FROM bethadba.foempregados fun
JOIN bethadba.focargos   car     ON car.i_cargos = fun.i_cargos
                                AND car.codi_emp = fun.codi_emp
JOIN bethadba.fodepto    dpto    ON dpto.i_depto = fun.i_depto
                                AND dpto.codi_emp = fun.codi_emp
JOIN bethadba.geempre    emp     ON emp.codi_emp = fun.codi_emp
WHERE fun.codi_emp IS NOT NULL
  AND fun.tipo_epr = 2
GROUP BY emp.codi_emp, emp.nome_emp
ORDER BY emp.nome_emp;
